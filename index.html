<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plateforme Ratours</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const GOOGLE_CLIENT_ID = '988519105715-eqfihmrhgotpkund2ub9nvb3ov7nfde4.apps.googleusercontent.com';
        const SPREADSHEET_ID = '186a_JILQOYaF52HWNWunctYmriWTYaRIo4rlDscixcw';
        
        const Icon = ({ name, size = 24 }) => {
            const icons = {
                home: "ğŸ ", calendar: "ğŸ“…", check: "âœ“", cart: "ğŸ›’",
                chef: "ğŸ½ï¸", users: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§", logout: "â†’", settings: "âš™ï¸",
                chart: "ğŸ“Š", baby: "ğŸ‘¶", plus: "+", x: "Ã—",
                edit: "âœï¸", save: "ğŸ’¾", trash: "ğŸ—‘ï¸", cloud: "â˜ï¸", sync: "ğŸ”„"
            };
            return <span style={{ fontSize: size }}>{icons[name] || "â€¢"}</span>;
        };

        class GoogleServicesManager {
            constructor() {
                this.accessToken = null;
                this.tokenClient = null;
                this.spreadsheetId = SPREADSHEET_ID;
                this.calendarId = localStorage.getItem('ratours_calendar_id') || null;
            }

            initialize() {
                return new Promise((resolve) => {
                    this.tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: GOOGLE_CLIENT_ID,
                        scope: 'https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/calendar',
                        callback: (response) => {
                            if (response.access_token) {
                                this.accessToken = response.access_token;
                                localStorage.setItem('gsheets_token', response.access_token);
                            }
                        },
                    });
                    const savedToken = localStorage.getItem('gsheets_token');
                    if (savedToken) this.accessToken = savedToken;
                    resolve(true);
                });
            }

            async requestAuth() {
                return new Promise((resolve) => {
                    this.tokenClient.callback = (response) => {
                        if (response.access_token) {
                            this.accessToken = response.access_token;
                            localStorage.setItem('gsheets_token', response.access_token);
                            resolve(true);
                        } else resolve(false);
                    };
                    this.tokenClient.requestAccessToken();
                });
            }

            isAuthenticated() { return !!this.accessToken; }
            hasSpreadsheet() { return !!this.spreadsheetId; }

            logout() {
                this.accessToken = null;
                localStorage.removeItem('gsheets_token');
            }

            async readSheet(sheetName) {
                try {
                    const url = `https://sheets.googleapis.com/v4/spreadsheets/${this.spreadsheetId}/values/${sheetName}!A:Z`;
                    const response = await fetch(url, {
                        headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    const result = await response.json();
                    return result.values || [];
                } catch (error) {
                    console.error(`Erreur lecture ${sheetName}:`, error);
                    return [];
                }
            }

            async writeSheet(sheetName, values) {
                try {
                    // Ã‰TAPE 1 : CLEAR le sheet
                    const clearUrl = `https://sheets.googleapis.com/v4/spreadsheets/${this.spreadsheetId}/values/${sheetName}!A:Z:clear`;
                    const clearResponse = await fetch(clearUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.accessToken}`,
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    if (!clearResponse.ok) {
                        console.error(`Erreur CLEAR ${clearResponse.status}`);
                        return false;
                    }
                    
                    // Ã‰TAPE 2 : Ã‰crire les nouvelles donnÃ©es
                    const updateUrl = `https://sheets.googleapis.com/v4/spreadsheets/${this.spreadsheetId}/values/${sheetName}!A1?valueInputOption=RAW`;
                    const updateResponse = await fetch(updateUrl, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${this.accessToken}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ values })
                    });
                    
                    if (!updateResponse.ok) {
                        console.error(`Erreur UPDATE ${updateResponse.status}`);
                        return false;
                    }
                    
                    return true;
                } catch (error) {
                    console.error(`Erreur Ã©criture ${sheetName}:`, error);
                    return false;
                }
            }

            // === GOOGLE CALENDAR ===
            
            async createTestCalendar() {
                try {
                    const url = 'https://www.googleapis.com/calendar/v3/calendars';
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.accessToken}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            summary: 'Ratours TEST',
                            description: 'Calendrier de test pour Plateforme Ratours',
                            timeZone: 'Europe/Paris'
                        })
                    });
                    
                    if (!response.ok) {
                        console.error('Erreur crÃ©ation calendrier:', response.status);
                        return null;
                    }
                    
                    const calendar = await response.json();
                    this.calendarId = calendar.id;
                    localStorage.setItem('ratours_calendar_id', calendar.id);
                    console.log('âœ… Calendrier TEST crÃ©Ã©:', calendar.id);
                    return calendar.id;
                } catch (error) {
                    console.error('Erreur crÃ©ation calendrier:', error);
                    return null;
                }
            }
            
            async listCalendarEvents() {
                if (!this.calendarId) return [];
                
                try {
                    const url = `https://www.googleapis.com/calendar/v3/calendars/${this.calendarId}/events?maxResults=100&singleEvents=true&orderBy=startTime`;
                    const response = await fetch(url, {
                        headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    
                    if (!response.ok) {
                        console.error('Erreur lecture Calendar:', response.status);
                        return [];
                    }
                    
                    const data = await response.json();
                    return data.items || [];
                } catch (error) {
                    console.error('Erreur lecture Calendar:', error);
                    return [];
                }
            }
            
            async createCalendarEvent(event) {
                if (!this.calendarId) return null;
                
                try {
                    const url = `https://www.googleapis.com/calendar/v3/calendars/${this.calendarId}/events`;
                    let eventBody;
                    
                    if (event.endDate) {
                        // Period event: all-day, multi-day
                        // Google Calendar end date is exclusive, so add 1 day
                        const endDateObj = new Date(event.endDate + 'T12:00:00');
                        endDateObj.setDate(endDateObj.getDate() + 1);
                        const exclusiveEnd = endDateObj.toISOString().split('T')[0];
                        eventBody = {
                            summary: event.title,
                            description: `[Ratours] ${event.category}`,
                            start: { date: event.date },
                            end: { date: exclusiveEnd }
                        };
                    } else {
                        // Single event with time
                        eventBody = {
                            summary: event.title,
                            description: `[Ratours] ${event.category}`,
                            start: {
                                dateTime: `${event.date}T${event.time || '09:00'}:00`,
                                timeZone: 'Europe/Paris'
                            },
                            end: {
                                dateTime: `${event.date}T${event.time ? this.addHour(event.time) : '10:00'}:00`,
                                timeZone: 'Europe/Paris'
                            }
                        };
                    }
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.accessToken}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(eventBody)
                    });
                    
                    if (!response.ok) {
                        console.error('Erreur crÃ©ation event:', response.status);
                        return null;
                    }
                    
                    const createdEvent = await response.json();
                    return createdEvent.id;
                } catch (error) {
                    console.error('Erreur crÃ©ation event:', error);
                    return null;
                }
            }
            
            async deleteCalendarEvent(calendarEventId) {
                if (!this.calendarId) return false;
                
                try {
                    const url = `https://www.googleapis.com/calendar/v3/calendars/${this.calendarId}/events/${calendarEventId}`;
                    const response = await fetch(url, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    
                    return response.ok;
                } catch (error) {
                    console.error('Erreur suppression event:', error);
                    return false;
                }
            }
            
            addHour(time) {
                const [h, m] = time.split(':');
                const newHour = (parseInt(h) + 1).toString().padStart(2, '0');
                return `${newHour}:${m}`;
            }

            arrayToObjects(array) {
                if (!array || array.length === 0) return [];
                const headers = array[0];
                return array.slice(1).map(row => {
                    const obj = {};
                    headers.forEach((header, index) => { obj[header] = row[index] || ''; });
                    return obj;
                });
            }

            objectsToArray(objects, headers) {
                if (!objects || objects.length === 0) return [headers];
                const rows = objects.map(obj => headers.map(header => obj[header] !== undefined ? String(obj[header]) : ''));
                return [headers, ...rows];
            }
        }

        const gsheets = new GoogleServicesManager();

        const App = () => {
            const [isGoogleReady, setIsGoogleReady] = useState(false);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [isSyncing, setIsSyncing] = useState(false);
            const [lastSync, setLastSync] = useState(null);
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showAddModal, setShowAddModal] = useState(false);
            const [addType, setAddType] = useState('');
            const [currentWeekOffset, setCurrentWeekOffset] = useState(0);
            const [editingInfo, setEditingInfo] = useState(null);
            const [calendarEnabled, setCalendarEnabled] = useState(!!localStorage.getItem('ratours_calendar_id'));
            const [calendarStatus, setCalendarStatus] = useState('');
            const [addCategoryModal, setAddCategoryModal] = useState(null); // { section: 'courses'|'todos'|'events' }
            const [newCatName, setNewCatName] = useState('');
            const [newCatEmoji, setNewCatEmoji] = useState('');

            const [users] = useState([
                { id: 1, name: 'Maman', color: 'bg-pink-400', emoji: 'ğŸ‘©' },
                { id: 2, name: 'Papa', color: 'bg-blue-400', emoji: 'ğŸ‘¨' },
            ]);

            const [externalPeople, setExternalPeople] = useState([
                { id: 4, name: 'Mamie', emoji: 'ğŸ‘µ' },
                { id: 5, name: 'Nounou', emoji: 'ğŸ§‘â€ğŸ¼' },
            ]);

            const [categories, setCategories] = useState({
                courses: [
                    { id: 'alimentaire', name: 'Alimentaire', emoji: 'ğŸ¥–' },
                    { id: 'enfant', name: 'Enfant', emoji: 'ğŸ¼' },
                    { id: 'maison', name: 'Maison', emoji: 'ğŸ§¹' },
                ],
                todos: [
                    { id: 'rdv', name: 'RDV', emoji: 'ğŸ“' },
                    { id: 'enfant', name: 'Enfant', emoji: 'ğŸ‘¶' },
                    { id: 'maison', name: 'Maison', emoji: 'ğŸ ' },
                ],
                events: [
                    { id: 'medical', name: 'MÃ©dical', emoji: 'ğŸ¥' },
                    { id: 'voyage', name: 'Voyage', emoji: 'âœˆï¸' },
                    { id: 'ecole', name: 'Ã‰cole', emoji: 'ğŸ«' },
                    { id: 'famille', name: 'Famille', emoji: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§' },
                ]
            });

            const [events, setEvents] = useState([
                { id: 1, title: 'RDV pÃ©diatre', date: '2026-01-24', category: 'medical', assignedTo: [1], emoji: 'ğŸ¥' },
            ]);

            const [todos, setTodos] = useState([
                { id: 1, title: 'Prendre RDV dentiste', category: 'rdv', priority: 'high', done: false, assignedTo: 1 },
                { id: 2, title: 'Acheter chaussures', category: 'enfant', priority: 'medium', done: false, assignedTo: 2 },
            ]);

            const [courses, setCourses] = useState([
                { id: 1, item: 'Lait bio', category: 'alimentaire', checked: false },
                { id: 2, item: 'Couches', category: 'enfant', checked: false },
            ]);

            const [menus, setMenus] = useState([
                { id: 1, day: 'Lundi', meal: 'PÃ¢tes bolognaise', emoji: 'ğŸ' },
                { id: 2, day: 'Mardi', meal: 'Poulet rÃ´ti', emoji: 'ğŸ—' },
            ]);
            
            const [notes, setNotes] = useState([]);

            const [guardSchedule, setGuardSchedule] = useState([
                { id: 1, date: '2026-01-20', morning: 1, afternoon: 2, notes: '' },
            ]);

            const [familyInfo, setFamilyInfo] = useState({
                urgences: [{ id: 1, label: 'PÃ©diatre', value: '01 23 45 67 89', type: 'phone' }],
                utiles: [{ id: 1, label: 'CrÃ¨che', value: '01 23 45 67 90', type: 'phone' }],
                links: [{ id: 1, label: 'Paris Famille', value: 'https://www.paris.fr', type: 'link' }],
                notes: [{ id: 1, label: 'Horaires', value: 'Mer 14h-18h', type: 'text' }],
            });

            const [newItem, setNewItem] = useState({
                title: '', date: '', endDate: '', time: '', category: '', priority: 'medium', assignedTo: null, day: '', isPeriod: false
            });

            const allPeople = [...users, ...externalPeople];

            useEffect(() => {
                const initGoogle = async () => {
                    await gsheets.initialize();
                    setIsGoogleReady(true);
                    setIsAuthenticated(gsheets.isAuthenticated());
                };
                if (window.google) {
                    initGoogle();
                } else {
                    const checkGoogle = setInterval(() => {
                        if (window.google) {
                            clearInterval(checkGoogle);
                            initGoogle();
                        }
                    }, 100);
                }
            }, []);

            // Charger les donnÃ©es du Google Sheet quand currentUser est dÃ©fini
            useEffect(() => {
                if (isAuthenticated && currentUser && gsheets.hasSpreadsheet()) {
                    console.log('ğŸ‘¤ Utilisateur connectÃ©, chargement des donnÃ©es...');
                    syncFromCloud();
                }
            }, [currentUser]);

            const syncFromCloud = async () => {
                if (!isAuthenticated) return;
                setIsSyncing(true);
                try {
                    const todosData = await gsheets.readSheet('todos');
                    if (todosData.length > 1) {
                        setTodos(gsheets.arrayToObjects(todosData).map(t => ({
                            ...t, id: parseInt(t.id), assignedTo: parseInt(t.assignedTo), done: t.done === 'true'
                        })));
                    }
                    const coursesData = await gsheets.readSheet('courses');
                    if (coursesData.length > 1) {
                        setCourses(gsheets.arrayToObjects(coursesData).map(c => ({
                            ...c, id: parseInt(c.id), checked: c.checked === 'true'
                        })));
                    }
                    const menusData = await gsheets.readSheet('menus');
                    if (menusData.length > 1) {
                        setMenus(gsheets.arrayToObjects(menusData).map(m => ({
                            ...m, id: parseInt(m.id)
                        })));
                    }
                    const eventsData = await gsheets.readSheet('events');
                    if (eventsData.length > 1) {
                        setEvents(gsheets.arrayToObjects(eventsData).map(e => ({
                            ...e, 
                            id: parseInt(e.id) || Date.now(),
                            assignedTo: e.assignedTo ? JSON.parse(e.assignedTo) : [],
                            calendarEventId: e.calendarEventId || null,
                            endDate: e.endDate || '',
                            emoji: e.emoji || 'ğŸ“…'
                        })));
                    }
                    const guardData = await gsheets.readSheet('guardSchedule');
                    if (guardData.length > 1) {
                        setGuardSchedule(gsheets.arrayToObjects(guardData).map(g => ({
                            ...g, id: parseInt(g.id),
                            morning: g.morning ? parseInt(g.morning) : null,
                            afternoon: g.afternoon ? parseInt(g.afternoon) : null
                        })));
                    }
                    const familyData = await gsheets.readSheet('familyInfo');
                    if (familyData.length > 1) {
                        const familyObjects = gsheets.arrayToObjects(familyData);
                        const reconstructed = { urgences: [], utiles: [], links: [], notes: [] };
                        familyObjects.forEach(item => {
                            if (reconstructed[item.section]) {
                                reconstructed[item.section].push({
                                    id: parseInt(item.id), label: item.label, value: item.value, type: item.type
                                });
                            }
                        });
                        setFamilyInfo(reconstructed);
                    }
                    
                    const notesData = await gsheets.readSheet('notes');
                    if (notesData.length > 1) {
                        setNotes(gsheets.arrayToObjects(notesData).map(n => ({
                            ...n,
                            id: parseInt(n.id) || Date.now(),
                            author: parseInt(n.author) || currentUser,
                            date: n.date || new Date().toISOString().split('T')[0]
                        })));
                    }
                    setLastSync(new Date());
                    console.log('âœ… Chargement terminÃ©');
                } catch (error) {
                    console.error('Erreur chargement:', error);
                }
                setIsSyncing(false);
            };

            const syncToCloud = async () => {
                if (!isAuthenticated) return;
                console.log('ğŸ’¾ Sauvegarde...');
                setIsSyncing(true);
                try {
                    await gsheets.writeSheet('todos', gsheets.objectsToArray(todos, ['id', 'title', 'category', 'priority', 'done', 'assignedTo']));
                    await gsheets.writeSheet('courses', gsheets.objectsToArray(courses, ['id', 'item', 'category', 'checked']));
                    await gsheets.writeSheet('menus', gsheets.objectsToArray(menus, ['id', 'day', 'meal', 'emoji']));
                    const eventsForSheet = events.map(e => ({ ...e, assignedTo: JSON.stringify(e.assignedTo) }));
                    await gsheets.writeSheet('events', gsheets.objectsToArray(eventsForSheet, ['id', 'title', 'date', 'endDate', 'time', 'category', 'assignedTo', 'emoji', 'calendarEventId']));
                    await gsheets.writeSheet('guardSchedule', gsheets.objectsToArray(guardSchedule, ['id', 'date', 'morning', 'afternoon', 'notes']));
                    const flatFamilyInfo = [];
                    Object.entries(familyInfo).forEach(([section, items]) => {
                        items.forEach(item => {
                            flatFamilyInfo.push({ section, id: item.id, label: item.label, value: item.value, type: item.type });
                        });
                    });
                    await gsheets.writeSheet('familyInfo', gsheets.objectsToArray(flatFamilyInfo, ['section', 'id', 'label', 'value', 'type']));
                    await gsheets.writeSheet('notes', gsheets.objectsToArray(notes, ['id', 'text', 'author', 'date']));
                    setLastSync(new Date());
                    console.log('âœ… Sauvegarde OK');
                } catch (error) {
                    console.error('Erreur sauvegarde:', error);
                }
                setIsSyncing(false);
            };


            const handleGoogleLogout = () => {
                if (confirm('Se dÃ©connecter de Google ?')) {
                    gsheets.logout();
                    setIsAuthenticated(false);
                    setCurrentUser(null);
                }
            };

            const handleGoogleLogin = async () => {
                const success = await gsheets.requestAuth();
                if (success) {
                    setIsAuthenticated(true);
                    await syncFromCloud();
                }
            };

            useEffect(() => {
                if (isAuthenticated && currentUser) {
                    const timer = setTimeout(() => syncToCloud(), 1000);
                    return () => clearTimeout(timer);
                }
            }, [todos, courses, menus, events, guardSchedule, familyInfo, notes, isAuthenticated, currentUser]);

            const resetNewItem = () => setNewItem({ title: '', date: '', endDate: '', time: '', category: '', priority: 'medium', assignedTo: null, day: '', isPeriod: false });

            const handleAdd = () => {
                if (addType === 'event' && newItem.title && newItem.date) {
                    const cat = categories.events.find(c => c.id === newItem.category);
                    const newEvent = {
                        id: Date.now(), 
                        title: newItem.title, 
                        date: newItem.date,
                        endDate: newItem.isPeriod && newItem.endDate ? newItem.endDate : '',
                        time: newItem.isPeriod ? '' : (newItem.time || ''),
                        category: newItem.category || 'general', 
                        assignedTo: [newItem.assignedTo || currentUser],
                        emoji: cat ? cat.emoji : 'ğŸ“…',
                        calendarEventId: null
                    };
                    setEvents([...events, newEvent]);
                    setShowAddModal(false);
                    resetNewItem();
                    if (calendarEnabled && gsheets.calendarId) {
                        gsheets.createCalendarEvent(newEvent).then(calEventId => {
                            if (calEventId) {
                                setEvents(prev => prev.map(e => e.id === newEvent.id ? { ...e, calendarEventId: calEventId } : e));
                            }
                        });
                    }
                } else if (addType === 'todo' && newItem.title) {
                    setTodos([...todos, {
                        id: Date.now(), title: newItem.title, category: newItem.category || 'general',
                        priority: newItem.priority, done: false, 
                        assignedTo: newItem.assignedTo !== undefined && newItem.assignedTo !== null ? newItem.assignedTo : null
                    }]);
                    setShowAddModal(false);
                    resetNewItem();
                } else if (addType === 'course' && newItem.title) {
                    setCourses([...courses, {
                        id: Date.now(), item: newItem.title, category: newItem.category || 'alimentaire', checked: false
                    }]);
                    setNewItem({ ...newItem, title: '' });
                } else if (addType === 'menu' && newItem.title && newItem.day) {
                    setMenus([...menus, { id: Date.now(), day: newItem.day, meal: newItem.title, emoji: 'ğŸ½ï¸' }]);
                    setShowAddModal(false);
                    resetNewItem();
                }
            };

            const toggleTodo = (id) => {
                const todo = todos.find(t => t.id === id);
                if (!todo) return;
                
                // Si la tÃ¢che est cochÃ©e (done) et n'Ã©tait pas assignÃ©e, demander qui l'a faite
                if (!todo.done && !todo.assignedTo) {
                    const who = prompt(`Qui a fait cette tÃ¢che ?\n1 - ${users[0].name}\n2 - ${users[1].name}`);
                    if (who === '1' || who === '2') {
                        setTodos(todos.map(t => t.id === id ? { ...t, done: true, assignedTo: parseInt(who) } : t));
                    }
                } else {
                    setTodos(todos.map(t => t.id === id ? { ...t, done: !t.done } : t));
                }
            };
            const toggleCourse = (id) => setCourses(courses.map(c => c.id === id ? { ...c, checked: !c.checked } : c));
            const deleteEvent = (id) => {
                if (confirm('Supprimer cet Ã©vÃ©nement ?')) {
                    const eventToDelete = events.find(e => e.id === id);
                    const newEvents = events.filter(e => e.id !== id);
                    setEvents(newEvents);
                    setTimeout(async () => {
                        const eventsForSheet = newEvents.map(e => ({ ...e, assignedTo: JSON.stringify(e.assignedTo) }));
                        await gsheets.writeSheet('events', gsheets.objectsToArray(eventsForSheet, ['id', 'title', 'date', 'endDate', 'time', 'category', 'assignedTo', 'emoji', 'calendarEventId']));
                    }, 500);
                    if (calendarEnabled && eventToDelete?.calendarEventId) {
                        gsheets.deleteCalendarEvent(eventToDelete.calendarEventId);
                    }
                }
            };
            
            const deleteTodo = (id) => {
                if (confirm('Supprimer cette tÃ¢che ?')) {
                    const newTodos = todos.filter(t => t.id !== id);
                    setTodos(newTodos);
                    setTimeout(async () => {
                        await gsheets.writeSheet('todos', gsheets.objectsToArray(newTodos, ['id', 'title', 'category', 'priority', 'done', 'assignedTo']));
                    }, 500);
                }
            };
            
            const deleteCourse = (id) => {
                if (confirm('Supprimer cet article ?')) {
                    const newCourses = courses.filter(c => c.id !== id);
                    setCourses(newCourses);
                    setTimeout(async () => {
                        await gsheets.writeSheet('courses', gsheets.objectsToArray(newCourses, ['id', 'item', 'category', 'checked']));
                    }, 500);
                }
            };
            
            const deleteMenu = (id) => {
                if (confirm('Supprimer ce menu ?')) {
                    const newMenus = menus.filter(m => m.id !== id);
                    setMenus(newMenus);
                    setTimeout(async () => {
                        await gsheets.writeSheet('menus', gsheets.objectsToArray(newMenus, ['id', 'day', 'meal', 'emoji']));
                    }, 500);
                }
            };
            
            
            const addNote = (text) => {
                if (text && text.trim().length > 0 && text.length <= 300) {
                    setNotes([{
                        id: Date.now(),
                        text: text.trim(),
                        author: currentUser,
                        date: new Date().toISOString().split('T')[0]
                    }, ...notes]);
                }
            };
            
            const deleteNote = (id) => {
                if (confirm('Supprimer cette note ?')) {
                    const newNotes = notes.filter(n => n.id !== id);
                    setNotes(newNotes);
                    setTimeout(async () => {
                        await gsheets.writeSheet('notes', gsheets.objectsToArray(newNotes, ['id', 'text', 'author', 'date']));
                    }, 500);
                }
            };

            const addFamilyInfo = (section, item) => {
                setFamilyInfo({ ...familyInfo, [section]: [...familyInfo[section], { ...item, id: Date.now() }] });
            };

            const deleteFamilyInfo = (section, id) => {
                setFamilyInfo({ ...familyInfo, [section]: familyInfo[section].filter(item => item.id !== id) });
            };

            // === GOOGLE CALENDAR ===
            const enableCalendar = async () => {
                setCalendarStatus('CrÃ©ation du calendrier...');
                try {
                    const existingId = localStorage.getItem('ratours_calendar_id');
                    if (existingId) {
                        gsheets.calendarId = existingId;
                        setCalendarEnabled(true);
                        setCalendarStatus('âœ… Calendrier connectÃ©');
                        return;
                    }
                    const calId = await gsheets.createTestCalendar();
                    if (calId) {
                        setCalendarEnabled(true);
                        setCalendarStatus('âœ… Calendrier "Ratours TEST" crÃ©Ã© !');
                    } else {
                        setCalendarStatus('âŒ Erreur lors de la crÃ©ation');
                    }
                } catch (error) {
                    setCalendarStatus('âŒ Erreur : ' + error.message);
                }
            };

            const disableCalendar = () => {
                if (confirm('DÃ©sactiver la sync Google Calendar ?\n(Le calendrier ne sera pas supprimÃ©)')) {
                    localStorage.removeItem('ratours_calendar_id');
                    gsheets.calendarId = null;
                    setCalendarEnabled(false);
                    setCalendarStatus('');
                }
            };

            const syncEventsToCalendar = async () => {
                if (!calendarEnabled || !gsheets.calendarId) return;
                setCalendarStatus('Sync en cours...');
                let synced = 0;
                for (const event of events) {
                    if (!event.calendarEventId) {
                        const calEventId = await gsheets.createCalendarEvent(event);
                        if (calEventId) {
                            event.calendarEventId = calEventId;
                            synced++;
                        }
                    }
                }
                if (synced > 0) {
                    setEvents([...events]);
                    setCalendarStatus(`âœ… ${synced} Ã©vÃ©nement(s) synchronisÃ©(s)`);
                } else {
                    setCalendarStatus('âœ… Tout est Ã  jour');
                }
            };

            // === CATEGORY MANAGEMENT ===
            const handleAddCategory = () => {
                if (!newCatName.trim() || !newCatEmoji || !addCategoryModal) return;
                const id = newCatName.trim().toLowerCase().replace(/\s+/g, '-');
                const section = addCategoryModal.section;
                setCategories({
                    ...categories,
                    [section]: [...categories[section], { id, name: newCatName.trim(), emoji: newCatEmoji }]
                });
                setAddCategoryModal(null);
                setNewCatName('');
                setNewCatEmoji('');
            };

            const calculateTaskStats = () => {
                const parent1Tasks = todos.filter(t => t.assignedTo === 1);
                const parent2Tasks = todos.filter(t => t.assignedTo === 2);
                const parent1Done = parent1Tasks.filter(t => t.done).length;
                const parent2Done = parent2Tasks.filter(t => t.done).length;
                const totalTasks = parent1Tasks.length + parent2Tasks.length;
                const parent1Share = totalTasks > 0 ? Math.round((parent1Tasks.length / totalTasks) * 100) : 50;
                const parent2Share = 100 - parent1Share;
                return {
                    parent1: { total: parent1Tasks.length, done: parent1Done, todo: parent1Tasks.length - parent1Done, share: parent1Share },
                    parent2: { total: parent2Tasks.length, done: parent2Done, todo: parent2Tasks.length - parent2Done, share: parent2Share },
                    totalTasks, totalDone: parent1Done + parent2Done, isBalanced: Math.abs(parent1Share - 50) <= 10
                };
            };

            const generateGuardWeek = () => {
                // Utiliser la date d'aujourd'hui comme base
                const today = new Date();
                const dayOfWeek = today.getDay(); // 0 = dimanche, 1 = lundi, etc.
                
                // Calculer le dÃ©but de la semaine (lundi)
                const weekStart = new Date(today);
                const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // Si dimanche, reculer de 6 jours
                weekStart.setDate(today.getDate() + daysToMonday + (currentWeekOffset * 7));
                
                const week = [];
                const dayNames = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
                for (let i = 0; i < 7; i++) {
                    const date = new Date(weekStart);
                    date.setDate(date.getDate() + i);
                    const dateStr = date.toISOString().split('T')[0];
                    const existing = guardSchedule.find(g => g.date === dateStr);
                    
                    // Marquer la date d'aujourd'hui
                    const isToday = dateStr === new Date().toISOString().split('T')[0];
                    
                    week.push({
                        date: dateStr, dayName: dayNames[date.getDay()],
                        displayDate: `${date.getDate()}/${date.getMonth() + 1}`,
                        morning: existing?.morning || null, afternoon: existing?.afternoon || null,
                        notes: existing?.notes || '', id: existing?.id || null,
                        isToday
                    });
                }
                return week;
            };

            const updateGuardSlot = (date, period, personId) => {
                const existing = guardSchedule.find(g => g.date === date);
                if (existing) {
                    setGuardSchedule(guardSchedule.map(g => g.date === date ? { ...g, [period]: personId } : g));
                } else {
                    setGuardSchedule([...guardSchedule, {
                        id: Date.now(), date, morning: period === 'morning' ? personId : null,
                        afternoon: period === 'afternoon' ? personId : null, notes: ''
                    }]);
                }
            };

            const stats = calculateTaskStats();
            const guardWeek = generateGuardWeek();

            if (!currentUser) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 flex items-center justify-center p-6">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                            <div className="text-center mb-8">
                                <div className="text-6xl mb-4">ğŸ </div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Plateforme Ratours</h1>
                                <p className="text-gray-600">Qui se connecte ?</p>
                            </div>
                            {isGoogleReady && !isAuthenticated && (
                                <div className="mb-6 p-4 bg-blue-50 rounded-2xl border-2 border-blue-200">
                                    <p className="text-sm text-blue-800 mb-3">â˜ï¸ Connectez-vous pour synchroniser</p>
                                    <button onClick={handleGoogleLogin} className="w-full bg-white border-2 border-gray-300 text-gray-700 px-4 py-3 rounded-xl hover:bg-gray-50 flex items-center justify-center gap-2">
                                        <Icon name="cloud" size={20} />
                                        <span className="font-medium">Se connecter avec Google</span>
                                    </button>
                                </div>
                            )}
                            {isAuthenticated && (
                                <div className="mb-6 p-4 bg-green-50 rounded-2xl border-2 border-green-200">
                                    <p className="text-sm text-green-800 mb-2">âœ… ConnectÃ©</p>
                                    <a href="https://docs.google.com/spreadsheets/d/186a_JILQOYaF52HWNWunctYmriWTYaRIo4rlDscixcw" target="_blank" className="text-xs text-blue-600">Ouvrir le Sheet â†’</a>
                                </div>
                            )}
                            <div className="space-y-4">
                                {users.map(user => (
                                    <button key={user.id} onClick={() => setCurrentUser(user.id)} className={`w-full ${user.color} text-white p-6 rounded-2xl hover:opacity-90 shadow-lg flex items-center justify-center gap-3`}>
                                        <span className="text-4xl">{user.emoji}</span>
                                        <span className="text-2xl font-bold">{user.name}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            const currentUserData = users.find(u => u.id === currentUser);
            const myTodos = todos.filter(t => !t.done && t.assignedTo === currentUser);

            return (
                <div className="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 pb-32">
                    <div className="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-5 shadow-xl">
                        <div className="flex justify-between max-w-4xl mx-auto">
                            <div>
                                <h1 className="text-2xl font-bold">Plateforme Ratours</h1>
                                <p className="text-purple-100 text-sm">{currentUserData.emoji} {currentUserData.name}</p>
                            </div>
                            <div className="flex gap-2">
                                {isAuthenticated && (
                                    <button onClick={syncFromCloud} disabled={isSyncing} className="bg-white bg-opacity-20 px-4 py-2 rounded-xl flex items-center gap-2">
                                        <Icon name="sync" size={18} />
                                        {lastSync && <span className="text-xs">{lastSync.toLocaleTimeString()}</span>}
                                    </button>
                                )}
                                <button onClick={handleGoogleLogout} className="bg-white bg-opacity-20 px-3 py-2 rounded-xl text-xs" title="DÃ©connexion Google">
                                        DÃ©co
                                    </button>
                                    <button onClick={() => setCurrentUser(null)} className="bg-white bg-opacity-20 px-4 py-2 rounded-xl">
                                        <Icon name="logout" size={18} />
                                    </button>
                            </div>
                        </div>
                    </div>

                    <div className="p-4 max-w-4xl mx-auto">
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6">
                                <div className="bg-gradient-to-r from-purple-400 to-pink-400 rounded-3xl p-6 text-white shadow-lg">
                                    <h2 className="text-3xl font-bold mb-2">Bonjour {currentUserData.name} ! ğŸ‘‹</h2>
                                    <p className="text-purple-100">{new Date().toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}</p>
                                </div>
                                
                                {/* TÃ¢ches urgentes */}
                                {todos.filter(t => !t.done && t.priority === 'high').length > 0 && (
                                    <div className="bg-red-50 border-2 border-red-300 rounded-2xl shadow-lg p-6">
                                        <h3 className="font-bold text-red-700 mb-4 flex items-center gap-2">
                                            <span className="text-2xl">ğŸ”´</span>
                                            <span>URGENT ({todos.filter(t => !t.done && t.priority === 'high').length})</span>
                                        </h3>
                                        {todos.filter(t => !t.done && t.priority === 'high').slice(0, 5).map(todo => (
                                            <div key={todo.id} className="flex items-center gap-3 py-2 bg-white rounded-xl px-3 mb-2">
                                                <input type="checkbox" className="h-5 w-5" onChange={() => toggleTodo(todo.id)} />
                                                <span className="flex-1 font-semibold">{todo.title}</span>
                                                <span className="text-xs text-gray-500">{users.find(u => u.id === todo.assignedTo)?.emoji || 'â“'}</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                <div className="bg-white rounded-2xl shadow-lg p-6">
                                    <h3 className="font-bold text-gray-800 mb-4">âœ… Mes tÃ¢ches ({myTodos.length})</h3>
                                    {myTodos.slice(0, 5).map(todo => (
                                        <div key={todo.id} className="flex items-center gap-3 py-2">
                                            <input type="checkbox" className="h-5 w-5" onChange={() => toggleTodo(todo.id)} />
                                            <span>{todo.title}</span>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-white rounded-2xl shadow-lg p-6">
                                    <h3 className="font-bold text-gray-800 mb-4">ğŸ›’ Courses ({courses.filter(c => !c.checked).length})</h3>
                                    {courses.filter(c => !c.checked).slice(0, 6).map(course => (
                                        <div key={course.id} className="flex items-center gap-3 py-1">
                                            <input type="checkbox" className="h-4 w-4" onChange={() => toggleCourse(course.id)} />
                                            <span className="text-sm">{course.item}</span>
                                        </div>
                                    ))}
                                </div>
                                
                                {notes.length > 0 && (
                                    <div className="bg-white rounded-2xl shadow-lg p-6">
                                        <h3 className="font-bold text-gray-800 mb-4">ğŸ“ DerniÃ¨res notes ({notes.length})</h3>
                                        {notes.slice(0, 3).map(note => (
                                            <div key={note.id} className="py-3 border-b last:border-0">
                                                <div className="flex items-center gap-2 mb-1">
                                                    <span className="text-lg">{users.find(u => u.id === note.author)?.emoji || 'ğŸ‘¤'}</span>
                                                    <span className="text-sm font-semibold">{users.find(u => u.id === note.author)?.name}</span>
                                                    <span className="text-xs text-gray-500">{new Date(note.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}</span>
                                                </div>
                                                <p className="text-sm text-gray-700 line-clamp-2">{note.text}</p>
                                            </div>
                                        ))}
                                        {notes.length > 3 && (
                                            <button onClick={() => setActiveTab('notes')} className="text-sm text-purple-600 mt-2 hover:underline">
                                                Voir toutes les notes â†’
                                            </button>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'calendar' && (
                            <div className="space-y-4">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-2xl font-bold">ğŸ“… Agenda</h2>
                                    {calendarEnabled && (
                                        <span className="text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded-full">ğŸ“… Calendar actif</span>
                                    )}
                                </div>
                                {events.sort((a, b) => a.date.localeCompare(b.date) || (a.time || '').localeCompare(b.time || '')).map(event => {
                                    const isPeriod = !!event.endDate;
                                    const dayCount = isPeriod ? Math.ceil((new Date(event.endDate) - new Date(event.date)) / 86400000) + 1 : 0;
                                    return (
                                        <div key={event.id} className={`bg-white rounded-2xl shadow-lg p-4 flex items-start gap-3 ${isPeriod ? 'border-l-4 border-purple-400' : ''}`}>
                                            <span className="text-3xl mt-1">{event.emoji}</span>
                                            <div className="flex-1 min-w-0">
                                                <h3 className="font-bold text-gray-800">{event.title}</h3>
                                                <p className="text-sm text-gray-600">
                                                    {isPeriod ? (
                                                        <>
                                                            {new Date(event.date + 'T12:00:00').toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}
                                                            {' â†’ '}
                                                            {new Date(event.endDate + 'T12:00:00').toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}
                                                            <span className="ml-2 bg-purple-100 text-purple-700 text-xs px-2 py-0.5 rounded-full">{dayCount}j</span>
                                                        </>
                                                    ) : (
                                                        <>
                                                            {new Date(event.date + 'T12:00:00').toLocaleDateString('fr-FR', { weekday: 'short', day: 'numeric', month: 'short' })}
                                                            {event.time && ` Ã  ${event.time}`}
                                                        </>
                                                    )}
                                                </p>
                                                {event.assignedTo && event.assignedTo.length > 0 && (
                                                    <div className="flex gap-1 mt-1">
                                                        {event.assignedTo.map(uid => {
                                                            const u = users.find(u => u.id === uid);
                                                            return u ? <span key={uid} className="text-sm">{u.emoji}</span> : null;
                                                        })}
                                                    </div>
                                                )}
                                            </div>
                                            <div className="flex flex-col items-center gap-1">
                                                {event.calendarEventId && <span className="text-xs text-blue-400" title="Sync Calendar">ğŸ“…</span>}
                                                <button onClick={() => deleteEvent(event.id)} className="text-red-400"><Icon name="x" size={18} /></button>
                                            </div>
                                        </div>
                                    );
                                })}
                                {events.length === 0 && (
                                    <div className="bg-gray-50 rounded-2xl p-8 text-center text-gray-500">
                                        Aucun Ã©vÃ©nement. Ajoutez-en un avec le bouton + !
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'todos' && (
                            <div className="space-y-4">
                                <h2 className="text-2xl font-bold">âœ… TÃ¢ches</h2>
                                
                                {/* TÃ¢ches non assignÃ©es */}
                                {todos.filter(t => !t.assignedTo).length > 0 && (
                                    <div className="bg-white rounded-2xl shadow-lg p-5 border-2 border-yellow-300">
                                        <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">
                                            <span className="text-2xl">â“</span>
                                            <span>Non assignÃ©es</span>
                                        </h3>
                                        {todos.filter(t => !t.assignedTo).map(todo => (
                                            <div key={todo.id} className="flex items-center justify-between py-3 border-b last:border-0">
                                                <div className="flex items-center gap-3 flex-1">
                                                    <input type="checkbox" checked={todo.done} onChange={() => toggleTodo(todo.id)} className="h-5 w-5" />
                                                    <span className={todo.done ? 'line-through text-gray-400' : ''}>{todo.title}</span>
                                                </div>
                                                <button onClick={() => deleteTodo(todo.id)} className="text-red-400"><Icon name="x" size={16} /></button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {/* TÃ¢ches par catÃ©gorie */}
                                {categories.todos.map(cat => {
                                    const catTodos = todos.filter(t => t.category === cat.id && t.assignedTo);
                                    if (catTodos.length === 0) return null;
                                    return (
                                        <div key={cat.id} className="bg-white rounded-2xl shadow-lg p-5">
                                            <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <span className="text-2xl">{cat.emoji}</span>
                                                <span>{cat.name}</span>
                                            </h3>
                                            {catTodos.map(todo => (
                                                <div key={todo.id} className="flex items-center justify-between py-3 border-b last:border-0">
                                                    <div className="flex items-center gap-3 flex-1">
                                                        <input type="checkbox" checked={todo.done} onChange={() => toggleTodo(todo.id)} className="h-5 w-5" />
                                                        <span className={todo.done ? 'line-through text-gray-400' : ''}>{todo.title}</span>
                                                    </div>
                                                    <button onClick={() => deleteTodo(todo.id)} className="text-red-400"><Icon name="x" size={16} /></button>
                                                </div>
                                            ))}
                                        </div>
                                    );
                                })}
                            </div>
                        )}

                        {activeTab === 'courses' && (
                            <div className="space-y-4">
                                <h2 className="text-2xl font-bold">ğŸ›’ Courses</h2>
                                {categories.courses.map(cat => {
                                    const catCourses = courses.filter(c => c.category === cat.id);
                                    if (catCourses.length === 0) return null;
                                    return (
                                        <div key={cat.id} className="bg-white rounded-2xl shadow-lg p-5">
                                            <h3 className="font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <span className="text-2xl">{cat.emoji}</span>
                                                <span>{cat.name}</span>
                                            </h3>
                                            {catCourses.map(course => (
                                                <div key={course.id} className="flex items-center justify-between py-2 border-b last:border-0">
                                                    <div className="flex items-center gap-3 flex-1">
                                                        <input type="checkbox" checked={course.checked} onChange={() => toggleCourse(course.id)} className="h-5 w-5" />
                                                        <span className={course.checked ? 'line-through text-gray-400' : ''}>{course.item}</span>
                                                    </div>
                                                    <button onClick={() => deleteCourse(course.id)} className="text-red-400"><Icon name="x" size={16} /></button>
                                                </div>
                                            ))}
                                        </div>
                                    );
                                })}
                            </div>
                        )}

                        {activeTab === 'menus' && (
                            <div className="space-y-4">
                                <h2 className="text-2xl font-bold">ğŸ½ï¸ Menus</h2>
                                {menus.map(m => (
                                    <div key={m.id} className="bg-white rounded-2xl shadow-lg p-5 flex gap-4">
                                        <span className="text-5xl">{m.emoji}</span>
                                        <div className="flex-1">
                                            <h3 className="font-bold text-lg">{m.day}</h3>
                                            <p className="text-gray-600">{m.meal}</p>
                                        </div>
                                        <button onClick={() => deleteMenu(m.id)} className="text-red-400"><Icon name="trash" size={20} /></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'stats' && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold">ğŸ“Š Statistiques</h2>
                                <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-6 border-2 border-purple-200">
                                    <h3 className="text-xl font-bold mb-4">âš–ï¸ Ã‰quilibre parental</h3>
                                    {stats.isBalanced && stats.totalTasks > 0 && (
                                        <div className="bg-green-100 border border-green-300 rounded-xl p-3 mb-4">
                                            <p className="text-green-800 font-medium">ğŸ‰ Parfait ! La charge est bien rÃ©partie !</p>
                                        </div>
                                    )}
                                    <div className="flex justify-between mb-2 text-sm">
                                        <span className="font-semibold text-pink-600">{users[0].emoji} {users[0].name}: {stats.parent1.share}%</span>
                                        <span className="font-semibold text-blue-600">{users[1].emoji} {users[1].name}: {stats.parent2.share}%</span>
                                    </div>
                                    <div className="w-full h-12 bg-gray-200 rounded-full overflow-hidden flex">
                                        <div className="h-full flex transition-all" style={{ width: `${stats.parent1.share}%` }}>
                                            <div className="bg-pink-500 flex items-center justify-center text-white text-sm font-bold" style={{ width: stats.parent1.total > 0 ? `${(stats.parent1.done / stats.parent1.total) * 100}%` : '0%' }}>{stats.parent1.done > 0 && `âœ“${stats.parent1.done}`}</div>
                                            <div className="bg-pink-200 flex items-center justify-center text-pink-700 text-sm" style={{ width: stats.parent1.total > 0 ? `${(stats.parent1.todo / stats.parent1.total) * 100}%` : '0%' }}>{stats.parent1.todo > 0 && stats.parent1.todo}</div>
                                        </div>
                                        <div className="h-full flex transition-all" style={{ width: `${stats.parent2.share}%` }}>
                                            <div className="bg-blue-200 flex items-center justify-center text-blue-700 text-sm" style={{ width: stats.parent2.total > 0 ? `${(stats.parent2.todo / stats.parent2.total) * 100}%` : '0%' }}>{stats.parent2.todo > 0 && stats.parent2.todo}</div>
                                            <div className="bg-blue-500 flex items-center justify-center text-white text-sm font-bold" style={{ width: stats.parent2.total > 0 ? `${(stats.parent2.done / stats.parent2.total) * 100}%` : '0%' }}>{stats.parent2.done > 0 && `âœ“${stats.parent2.done}`}</div>
                                        </div>
                                    </div>
                                    <div className="text-center mt-4 bg-white rounded-xl p-3">
                                        <p className="font-medium">{stats.totalDone} / {stats.totalTasks} tÃ¢ches accomplies</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'guard' && (
                            <div className="space-y-4">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-2xl font-bold">ğŸ‘¶ Garde</h2>
                                    <div className="flex gap-2">
                                        <button onClick={() => setCurrentWeekOffset(currentWeekOffset - 1)} className="bg-purple-100 px-3 py-2 rounded-xl text-sm">â† PrÃ©c.</button>
                                        <button onClick={() => setCurrentWeekOffset(0)} className="bg-purple-500 text-white px-3 py-2 rounded-xl text-sm">Aujourd'hui</button>
                                        <button onClick={() => setCurrentWeekOffset(currentWeekOffset + 1)} className="bg-purple-100 px-3 py-2 rounded-xl text-sm">Suiv. â†’</button>
                                    </div>
                                </div>
                                {guardWeek.map(day => (
                                    <div key={day.date} className={`bg-white rounded-2xl shadow-lg p-5 ${day.isToday ? 'border-2 border-purple-500' : ''}`}>
                                        <h3 className="font-bold text-lg mb-2">
                                            {day.dayName} {day.displayDate}
                                            {day.isToday && <span className="ml-2 text-xs bg-purple-500 text-white px-2 py-1 rounded-full">Aujourd'hui</span>}
                                        </h3>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-blue-50 rounded-xl p-3">
                                                <p className="text-xs text-blue-600 mb-2">â˜€ï¸ Matin</p>
                                                <select value={day.morning || ''} onChange={(e) => updateGuardSlot(day.date, 'morning', parseInt(e.target.value))} className="w-full bg-white border rounded-lg px-2 py-1 text-sm">
                                                    <option value="">Non assignÃ©</option>
                                                    {allPeople.map(p => <option key={p.id} value={p.id}>{p.emoji} {p.name}</option>)}
                                                </select>
                                            </div>
                                            <div className="bg-orange-50 rounded-xl p-3">
                                                <p className="text-xs text-orange-600 mb-2">ğŸŒ™ AprÃ¨s-midi</p>
                                                <select value={day.afternoon || ''} onChange={(e) => updateGuardSlot(day.date, 'afternoon', parseInt(e.target.value))} className="w-full bg-white border rounded-lg px-2 py-1 text-sm">
                                                    <option value="">Non assignÃ©</option>
                                                    {allPeople.map(p => <option key={p.id} value={p.id}>{p.emoji} {p.name}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'family' && (
                            <div className="space-y-4">
                                <h2 className="text-2xl font-bold">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Infos Famille</h2>
                                <div className="bg-white rounded-2xl shadow-lg p-5">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="font-bold flex items-center gap-2"><span className="text-2xl">ğŸš¨</span> Urgences</h3>
                                        <button onClick={() => setEditingInfo({ section: 'urgences', type: 'phone' })} className="text-purple-600"><Icon name="plus" size={20} /></button>
                                    </div>
                                    {familyInfo.urgences.map(item => (
                                        <div key={item.id} className="py-2 border-b last:border-0 flex justify-between">
                                            <span className="text-gray-700">{item.label}</span>
                                            <div className="flex gap-3 items-center">
                                                <span className="font-semibold">{item.value}</span>
                                                <button onClick={() => deleteFamilyInfo('urgences', item.id)} className="text-red-400"><Icon name="trash" size={16} /></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-white rounded-2xl shadow-lg p-5">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="font-bold flex items-center gap-2"><span className="text-2xl">ğŸ“</span> NumÃ©ros utiles</h3>
                                        <button onClick={() => setEditingInfo({ section: 'utiles', type: 'phone' })} className="text-purple-600"><Icon name="plus" size={20} /></button>
                                    </div>
                                    {familyInfo.utiles.map(item => (
                                        <div key={item.id} className="py-2 border-b last:border-0 flex justify-between">
                                            <span className="text-gray-700">{item.label}</span>
                                            <div className="flex gap-3 items-center">
                                                <span className="font-semibold">{item.value}</span>
                                                <button onClick={() => deleteFamilyInfo('utiles', item.id)} className="text-red-400"><Icon name="trash" size={16} /></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-white rounded-2xl shadow-lg p-5">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="font-bold flex items-center gap-2"><span className="text-2xl">ğŸ”—</span> Liens</h3>
                                        <button onClick={() => setEditingInfo({ section: 'links', type: 'link' })} className="text-purple-600"><Icon name="plus" size={20} /></button>
                                    </div>
                                    {familyInfo.links.map(item => (
                                        <div key={item.id} className="py-2 border-b last:border-0">
                                            <div className="flex justify-between items-center">
                                                <div className="flex-1">
                                                    <p className="text-gray-700">{item.label}</p>
                                                    <a href={item.value} target="_blank" rel="noopener noreferrer" className="text-sm text-blue-600 hover:underline">{item.value}</a>
                                                </div>
                                                <button onClick={() => deleteFamilyInfo('links', item.id)} className="text-red-400 ml-3"><Icon name="trash" size={16} /></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                {editingInfo && (
                                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                        <div className="bg-white rounded-3xl shadow-2xl max-w-md w-full p-6">
                                            <h3 className="text-xl font-bold mb-4">Ajouter</h3>
                                            <input type="text" placeholder="Label" id="info-label" className="w-full px-4 py-3 border-2 rounded-xl mb-3" />
                                            <input type={editingInfo.type === 'link' ? 'url' : 'text'} placeholder={editingInfo.type === 'phone' ? 'TÃ©lÃ©phone' : 'URL'} id="info-value" className="w-full px-4 py-3 border-2 rounded-xl mb-4" />
                                            <div className="flex gap-3">
                                                <button onClick={() => setEditingInfo(null)} className="flex-1 bg-gray-100 py-3 rounded-xl">Annuler</button>
                                                <button onClick={() => {
                                                    const label = document.getElementById('info-label').value;
                                                    const value = document.getElementById('info-value').value;
                                                    if (label && value) {
                                                        addFamilyInfo(editingInfo.section, { label, value, type: editingInfo.type });
                                                        setEditingInfo(null);
                                                    }
                                                }} className="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl">Ajouter</button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'notes' && (
                            <div className="space-y-4">
                                <h2 className="text-2xl font-bold">ğŸ“ Notes</h2>
                                
                                <div className="bg-white rounded-2xl shadow-lg p-5">
                                    <textarea 
                                        placeholder="Ã‰crivez une note (max 300 caractÃ¨res)..."
                                        maxLength="300"
                                        className="w-full px-4 py-3 border-2 rounded-xl resize-none"
                                        rows="3"
                                        onKeyDown={(e) => {
                                            if (e.key === 'Enter' && !e.shiftKey) {
                                                e.preventDefault();
                                                addNote(e.target.value);
                                                e.target.value = '';
                                            }
                                        }}
                                    />
                                    <p className="text-xs text-gray-500 mt-2">Appuyez sur EntrÃ©e pour ajouter (Shift+EntrÃ©e pour nouvelle ligne)</p>
                                </div>
                                
                                <div className="space-y-3">
                                    {notes.map(note => (
                                        <div key={note.id} className="bg-white rounded-2xl shadow-lg p-5">
                                            <div className="flex justify-between items-start mb-2">
                                                <div className="flex items-center gap-2">
                                                    <span className="text-2xl">{users.find(u => u.id === note.author)?.emoji || 'ğŸ‘¤'}</span>
                                                    <span className="font-semibold">{users.find(u => u.id === note.author)?.name || 'Inconnu'}</span>
                                                    <span className="text-xs text-gray-500">{new Date(note.date).toLocaleDateString('fr-FR')}</span>
                                                </div>
                                                <button onClick={() => deleteNote(note.id)} className="text-red-400">
                                                    <Icon name="x" size={16} />
                                                </button>
                                            </div>
                                            <p className="text-gray-700 whitespace-pre-wrap">{note.text}</p>
                                        </div>
                                    ))}
                                    {notes.length === 0 && (
                                        <div className="bg-gray-50 rounded-2xl p-8 text-center text-gray-500">
                                            Aucune note. Ã‰crivez-en une ci-dessus !
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'settings' && (
                            <div className="space-y-4">
                                <h2 className="text-2xl font-bold">âš™ï¸ RÃ©glages</h2>
                                
                                {/* Google Calendar */}
                                <div className="bg-white rounded-2xl shadow-lg p-5">
                                    <h3 className="font-bold flex items-center gap-2 mb-3"><span className="text-2xl">ğŸ“…</span> Google Calendar</h3>
                                    <p className="text-sm text-gray-500 mb-4">
                                        Synchronise les Ã©vÃ©nements avec un calendrier "Ratours TEST" dÃ©diÃ©.
                                    </p>
                                    {!calendarEnabled ? (
                                        <button onClick={enableCalendar} className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-xl font-semibold">
                                            ğŸ“… Activer Google Calendar
                                        </button>
                                    ) : (
                                        <div className="space-y-3">
                                            <div className="flex items-center gap-2 bg-green-50 border border-green-200 rounded-xl p-3">
                                                <span>âœ…</span>
                                                <span className="text-green-800 text-sm font-medium">Calendar activÃ©</span>
                                            </div>
                                            <button onClick={syncEventsToCalendar} className="w-full bg-blue-50 border border-blue-200 text-blue-700 py-2.5 rounded-xl text-sm font-medium">
                                                ğŸ”„ Synchroniser les Ã©vÃ©nements existants
                                            </button>
                                            <button onClick={disableCalendar} className="w-full bg-gray-100 text-gray-500 py-2 rounded-xl text-xs">
                                                DÃ©sactiver
                                            </button>
                                        </div>
                                    )}
                                    {calendarStatus && <p className="text-sm text-gray-600 mt-3 text-center">{calendarStatus}</p>}
                                </div>

                                {/* Personnes externes */}
                                <div className="bg-white rounded-2xl shadow-lg p-5">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="font-bold flex items-center gap-2"><span className="text-2xl">ğŸ‘¥</span> Personnes externes</h3>
                                        <button onClick={() => {
                                            const name = prompt('Nom de la personne :');
                                            const emoji = prompt('Emoji (ex: ğŸ‘´) :');
                                            if (name && emoji) {
                                                const maxId = Math.max(...externalPeople.map(p => p.id), ...users.map(u => u.id));
                                                setExternalPeople([...externalPeople, { id: maxId + 1, name, emoji }]);
                                            }
                                        }} className="text-purple-600"><Icon name="plus" size={20} /></button>
                                    </div>
                                    {externalPeople.map(person => (
                                        <div key={person.id} className="py-2 border-b last:border-0 flex justify-between items-center">
                                            <div className="flex items-center gap-3">
                                                <span className="text-2xl">{person.emoji}</span>
                                                <span className="font-semibold">{person.name}</span>
                                            </div>
                                            <button onClick={() => setExternalPeople(externalPeople.filter(p => p.id !== person.id))} className="text-red-400"><Icon name="trash" size={16} /></button>
                                        </div>
                                    ))}
                                </div>

                                {/* CatÃ©gories Courses */}
                                <div className="bg-white rounded-2xl shadow-lg p-5">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="font-bold flex items-center gap-2"><span className="text-2xl">ğŸ›’</span> CatÃ©gories Courses</h3>
                                        <button onClick={() => setAddCategoryModal({ section: 'courses' })} className="bg-purple-100 text-purple-600 px-3 py-1 rounded-lg text-sm font-medium">+ Ajouter</button>
                                    </div>
                                    {categories.courses.map(cat => (
                                        <div key={cat.id} className="py-2 border-b last:border-0 flex justify-between items-center">
                                            <div className="flex items-center gap-3">
                                                <span className="text-2xl">{cat.emoji}</span>
                                                <span>{cat.name}</span>
                                            </div>
                                            <button onClick={() => setCategories({ ...categories, courses: categories.courses.filter(c => c.id !== cat.id) })} className="text-red-400"><Icon name="trash" size={16} /></button>
                                        </div>
                                    ))}
                                </div>

                                {/* CatÃ©gories TÃ¢ches */}
                                <div className="bg-white rounded-2xl shadow-lg p-5">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="font-bold flex items-center gap-2"><span className="text-2xl">âœ…</span> CatÃ©gories TÃ¢ches</h3>
                                        <button onClick={() => setAddCategoryModal({ section: 'todos' })} className="bg-purple-100 text-purple-600 px-3 py-1 rounded-lg text-sm font-medium">+ Ajouter</button>
                                    </div>
                                    {categories.todos.map(cat => (
                                        <div key={cat.id} className="py-2 border-b last:border-0 flex justify-between items-center">
                                            <div className="flex items-center gap-3">
                                                <span className="text-2xl">{cat.emoji}</span>
                                                <span>{cat.name}</span>
                                            </div>
                                            <button onClick={() => setCategories({ ...categories, todos: categories.todos.filter(c => c.id !== cat.id) })} className="text-red-400"><Icon name="trash" size={16} /></button>
                                        </div>
                                    ))}
                                </div>

                                {/* CatÃ©gories Ã‰vÃ©nements */}
                                <div className="bg-white rounded-2xl shadow-lg p-5">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="font-bold flex items-center gap-2"><span className="text-2xl">ğŸ“…</span> CatÃ©gories Ã‰vÃ©nements</h3>
                                        <button onClick={() => setAddCategoryModal({ section: 'events' })} className="bg-purple-100 text-purple-600 px-3 py-1 rounded-lg text-sm font-medium">+ Ajouter</button>
                                    </div>
                                    {categories.events.map(cat => (
                                        <div key={cat.id} className="py-2 border-b last:border-0 flex justify-between items-center">
                                            <div className="flex items-center gap-3">
                                                <span className="text-2xl">{cat.emoji}</span>
                                                <span>{cat.name}</span>
                                            </div>
                                            <button onClick={() => setCategories({ ...categories, events: categories.events.filter(c => c.id !== cat.id) })} className="text-red-400"><Icon name="trash" size={16} /></button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    <button onClick={() => setShowAddModal(true)} className="fixed bottom-28 right-5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full p-4 shadow-2xl hover:scale-110 transition-transform z-40">
                        <Icon name="plus" size={26} />
                    </button>

                    {/* Add Item Modal */}
                    {showAddModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50">
                            <div className="bg-white rounded-t-3xl sm:rounded-3xl shadow-2xl max-w-md w-full p-6 max-h-[85vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-5">
                                    <h3 className="text-xl font-bold">Ajouter</h3>
                                    <button onClick={() => { setShowAddModal(false); setAddType(''); resetNewItem(); }} className="text-gray-400 p-1">
                                        <Icon name="x" size={24} />
                                    </button>
                                </div>
                                {!addType ? (
                                    <div className="space-y-2">
                                        <button onClick={() => setAddType('event')} className="w-full bg-blue-50 hover:bg-blue-100 p-4 rounded-2xl text-left flex items-center gap-3">
                                            <span className="text-2xl">ğŸ“…</span><span className="font-semibold">Ã‰vÃ©nement</span>
                                        </button>
                                        <button onClick={() => setAddType('todo')} className="w-full bg-green-50 hover:bg-green-100 p-4 rounded-2xl text-left flex items-center gap-3">
                                            <span className="text-2xl">âœ…</span><span className="font-semibold">TÃ¢che</span>
                                        </button>
                                        <button onClick={() => setAddType('course')} className="w-full bg-orange-50 hover:bg-orange-100 p-4 rounded-2xl text-left flex items-center gap-3">
                                            <span className="text-2xl">ğŸ›’</span><span className="font-semibold">Course</span>
                                        </button>
                                        <button onClick={() => setAddType('menu')} className="w-full bg-purple-50 hover:bg-purple-100 p-4 rounded-2xl text-left flex items-center gap-3">
                                            <span className="text-2xl">ğŸ½ï¸</span><span className="font-semibold">Menu</span>
                                        </button>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        <input type="text" placeholder={addType === 'course' ? 'Article' : addType === 'menu' ? 'Plat' : 'Titre'} value={newItem.title} onChange={(e) => setNewItem({ ...newItem, title: e.target.value })} className="w-full px-4 py-3 border-2 rounded-xl" autoFocus />
                                        {addType === 'menu' && (
                                            <select value={newItem.day} onChange={(e) => setNewItem({ ...newItem, day: e.target.value })} className="w-full px-4 py-3 border-2 rounded-xl">
                                                <option value="">Jour</option>
                                                {['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'].map(d => <option key={d} value={d}>{d}</option>)}
                                            </select>
                                        )}
                                        {addType === 'event' && (
                                            <>
                                                <div className="flex gap-2 bg-gray-100 p-1 rounded-xl">
                                                    <button onClick={() => setNewItem({ ...newItem, isPeriod: false, endDate: '' })} className={`flex-1 py-2 rounded-lg text-sm font-medium ${!newItem.isPeriod ? 'bg-white shadow text-purple-700' : 'text-gray-500'}`}>
                                                        ğŸ“ Ponctuel
                                                    </button>
                                                    <button onClick={() => setNewItem({ ...newItem, isPeriod: true, time: '' })} className={`flex-1 py-2 rounded-lg text-sm font-medium ${newItem.isPeriod ? 'bg-white shadow text-purple-700' : 'text-gray-500'}`}>
                                                        ğŸ“… PÃ©riode
                                                    </button>
                                                </div>
                                                <div className="flex gap-2">
                                                    <div className="flex-1">
                                                        <label className="text-xs text-gray-500 mb-1 block">{newItem.isPeriod ? 'DÃ©but' : 'Date'}</label>
                                                        <input type="date" value={newItem.date} onChange={(e) => setNewItem({ ...newItem, date: e.target.value })} className="w-full px-3 py-3 border-2 rounded-xl" />
                                                    </div>
                                                    {newItem.isPeriod && (
                                                        <div className="flex-1">
                                                            <label className="text-xs text-gray-500 mb-1 block">Fin</label>
                                                            <input type="date" value={newItem.endDate} min={newItem.date} onChange={(e) => setNewItem({ ...newItem, endDate: e.target.value })} className="w-full px-3 py-3 border-2 rounded-xl" />
                                                        </div>
                                                    )}
                                                </div>
                                                {!newItem.isPeriod && (
                                                    <input type="time" value={newItem.time} onChange={(e) => setNewItem({ ...newItem, time: e.target.value })} className="w-full px-4 py-3 border-2 rounded-xl" />
                                                )}
                                                <select value={newItem.category} onChange={(e) => setNewItem({ ...newItem, category: e.target.value })} className="w-full px-4 py-3 border-2 rounded-xl">
                                                    <option value="">CatÃ©gorie</option>
                                                    {categories.events.map(c => <option key={c.id} value={c.id}>{c.emoji} {c.name}</option>)}
                                                </select>
                                            </>
                                        )}
                                        {addType === 'todo' && (
                                            <>
                                                <select value={newItem.category} onChange={(e) => setNewItem({ ...newItem, category: e.target.value })} className="w-full px-4 py-3 border-2 rounded-xl">
                                                    <option value="">CatÃ©gorie</option>
                                                    {categories.todos.map(c => <option key={c.id} value={c.id}>{c.emoji} {c.name}</option>)}
                                                </select>
                                                <select value={newItem.priority} onChange={(e) => setNewItem({ ...newItem, priority: e.target.value })} className="w-full px-4 py-3 border-2 rounded-xl">
                                                    <option value="low">âšª Basse</option>
                                                    <option value="medium">ğŸŸ¡ Moyenne</option>
                                                    <option value="high">ğŸ”´ Haute</option>
                                                </select>
                                                <select value={newItem.assignedTo || ''} onChange={(e) => setNewItem({ ...newItem, assignedTo: e.target.value ? parseInt(e.target.value) : null })} className="w-full px-4 py-3 border-2 rounded-xl">
                                                    <option value="">â“ Non assignÃ©</option>
                                                    {users.map(u => <option key={u.id} value={u.id}>{u.emoji} {u.name}</option>)}
                                                </select>
                                            </>
                                        )}
                                        {addType === 'course' && (
                                            <select value={newItem.category} onChange={(e) => setNewItem({ ...newItem, category: e.target.value })} className="w-full px-4 py-3 border-2 rounded-xl">
                                                {categories.courses.map(c => <option key={c.id} value={c.id}>{c.emoji} {c.name}</option>)}
                                            </select>
                                        )}
                                        <div className="flex gap-3 mt-4">
                                            <button onClick={() => { setAddType(''); resetNewItem(); }} className="flex-1 bg-gray-100 py-3 rounded-xl">Retour</button>
                                            <button onClick={handleAdd} className="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl font-medium">Ajouter</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Category Add Modal */}
                    {addCategoryModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end sm:items-center justify-center z-50" onClick={(e) => { if (e.target === e.currentTarget) { setAddCategoryModal(null); setNewCatName(''); setNewCatEmoji(''); } }}>
                            <div className="bg-white rounded-t-3xl sm:rounded-3xl shadow-2xl max-w-md w-full p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold">
                                        Nouvelle catÃ©gorie {addCategoryModal.section === 'courses' ? 'ğŸ›’' : addCategoryModal.section === 'todos' ? 'âœ…' : 'ğŸ“…'}
                                    </h3>
                                    <button onClick={() => { setAddCategoryModal(null); setNewCatName(''); setNewCatEmoji(''); }} className="text-gray-400">
                                        <Icon name="x" size={22} />
                                    </button>
                                </div>
                                <input 
                                    type="text" 
                                    placeholder="Nom de la catÃ©gorie" 
                                    value={newCatName} 
                                    onChange={(e) => setNewCatName(e.target.value)} 
                                    className="w-full px-4 py-3 border-2 rounded-xl mb-4" 
                                    autoFocus 
                                />
                                <p className="text-sm text-gray-500 mb-2">Choisir un emoji :</p>
                                <div className="grid grid-cols-8 gap-1.5 mb-4 max-h-40 overflow-y-auto p-1">
                                    {['ğŸ ','ğŸ¥','ğŸ«','ğŸ‰','ğŸ­','ğŸµ','ğŸ¨','ğŸ‹ï¸','ğŸš—','âœˆï¸','ğŸ–ï¸','â›ª','ğŸ’¼','ğŸ’°','ğŸ“¦','ğŸ“±','ğŸ”§','ğŸ§¹','ğŸ¼','ğŸ‘¶','ğŸ‘¨â€ğŸ‘©â€ğŸ‘§','ğŸ‘µ','ğŸ¶','ğŸ±','ğŸ¥–','ğŸ¥—','ğŸ¥©','ğŸ•','ğŸ°','ğŸ§','â˜•','ğŸ·','ğŸ’Š','ğŸ©º','ğŸ“','ğŸ“','ğŸ','ğŸ›ï¸','ğŸ‘—','ğŸ‘Ÿ','ğŸ§¸','ğŸ“š','ğŸ“','âš½','ğŸ®','ğŸŒ¸','ğŸŒ','â¤ï¸'].map(e => (
                                        <button 
                                            key={e} 
                                            onClick={() => setNewCatEmoji(e)} 
                                            className={`text-2xl p-1.5 rounded-lg hover:bg-purple-50 transition-colors ${newCatEmoji === e ? 'bg-purple-100 ring-2 ring-purple-400 scale-110' : ''}`}
                                        >
                                            {e}
                                        </button>
                                    ))}
                                </div>
                                {newCatEmoji && newCatName.trim() && (
                                    <div className="flex items-center gap-2 bg-purple-50 rounded-xl p-3 mb-4">
                                        <span className="text-2xl">{newCatEmoji}</span>
                                        <span className="font-medium">{newCatName}</span>
                                    </div>
                                )}
                                <div className="flex gap-3">
                                    <button onClick={() => { setAddCategoryModal(null); setNewCatName(''); setNewCatEmoji(''); }} className="flex-1 bg-gray-100 py-3 rounded-xl">Annuler</button>
                                    <button 
                                        onClick={handleAddCategory} 
                                        disabled={!newCatName.trim() || !newCatEmoji}
                                        className={`flex-1 py-3 rounded-xl font-medium ${newCatName.trim() && newCatEmoji ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white' : 'bg-gray-200 text-gray-400'}`}
                                    >
                                        Ajouter
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-50">
                        <div className="max-w-4xl mx-auto px-2 py-1.5">
                            <div className="grid grid-cols-5 gap-0.5">
                                {[
                                    { id: 'dashboard', label: 'Accueil', emoji: 'ğŸ ' },
                                    { id: 'calendar', label: 'Agenda', emoji: 'ğŸ“…' },
                                    { id: 'todos', label: 'TÃ¢ches', emoji: 'âœ…' },
                                    { id: 'courses', label: 'Courses', emoji: 'ğŸ›’' },
                                    { id: 'menus', label: 'Menus', emoji: 'ğŸ½ï¸' },
                                ].map(tab => (
                                    <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex flex-col items-center py-1.5 rounded-xl ${activeTab === tab.id ? 'bg-purple-100 text-purple-600' : 'text-gray-400'}`}>
                                        <span className="text-lg">{tab.emoji}</span>
                                        <span className="text-[10px] leading-tight">{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                            <div className="grid grid-cols-5 gap-0.5 mt-0.5">
                                {[
                                    { id: 'stats', label: 'Stats', emoji: 'ğŸ“Š' },
                                    { id: 'guard', label: 'Garde', emoji: 'ğŸ‘¶' },
                                    { id: 'notes', label: 'Notes', emoji: 'ğŸ“' },
                                    { id: 'family', label: 'Infos', emoji: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§' },
                                    { id: 'settings', label: 'RÃ©glages', emoji: 'âš™ï¸' },
                                ].map(tab => (
                                    <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex flex-col items-center py-1.5 rounded-xl ${activeTab === tab.id ? 'bg-purple-100 text-purple-600' : 'text-gray-400'}`}>
                                        <span className="text-lg">{tab.emoji}</span>
                                        <span className="text-[10px] leading-tight">{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
